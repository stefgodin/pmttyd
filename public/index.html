<!DOCTYPE html>
<html lang="en">

<head>
    <title>PMTTYD - Badges</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link id="badgedata" rel="preload" href="/assets/badges.json" as="fetch" crossorigin="anonymous">
    <link id="badgesprite" rel="preload" href="/assets/badges.png" as="image">
    <link id="itemdata" rel="preload" href="/assets/items.json" as="fetch" crossorigin="anonymous">
    <link id="itemsprite" rel="preload" href="/assets/items.png" as="image">

    <!-- xs -->
    <style>
        @media not print {
            img.decoded {
                background: none !important;
            }
        }

        @font-face {
            font-family: 'HeyGorgeous';
            src: url('/static/heygorgeous.ttf');
        }

        :root {
            --color-light: white;
            --color-base: grey;
            --color-dark: black;

            font-family: Verdana, sans-serif;
        }

        .badges {
            --color-light: #c5fd81;
            --color-base: #41de30;
            --color-dark: #259a19;
        }

        .recipes {
            --color-light: #e39bbf;
            --color-base: #da7aaa;
            --color-dark: #b43273;
        }

        .free-red {
            --color-light: #e7a698;
            --color-base: #da7762;
            --color-dark: #d05840;
        }

        .starpieces {
            --color-light: #ebd193;
            --color-base: #e6c576;
            --color-dark: #c29323;
        }

        .shinesprites {
            --color-light: #9abce5;
            --color-base: #558ed3;
            --color-dark: #2f6cb6;
        }

        .tattlelog {
            --color-light: #bfb2cd;
            --color-base: #876fa1;
            --color-dark: #59476c;
        }

        html {
            margin: 0;
            padding: 0;
            min-height: 100%;
        }

        body {
            background-image: url('/static/background_1.png');
            background-size: cover;
            background-repeat: no-repeat;
            min-height: 100%;
            margin: 0;
            padding: 0;
        }

        main {
            margin-top: 3em;
            padding: 0.25em;
            max-width: 996px;
            margin-left: auto;
            margin-right: auto;
        }

        .hidden {
            display: none;
        }

        .list-container {
            background-size: 200px;
            background-color: var(--color-base);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
        }

        .list {
            list-style-type: none;
            margin: 0;
            background-color: transparent;
            background-image: url('/static/items_background.png');
            background-size: 200px;
            padding: 1em;
            border-radius: 10px;
            background-color: var(--color-light);
        }

        .list li {
            display: inline-block;
        }

        nav {
            width: 100%;
            position: absolute;
            top: 0;
        }

        .nav-content {
            width: 100%;
            max-width: 996px;
            margin-left: auto;
            margin-right: auto;
        }

        nav .nav-section {
            position: relative;
            vertical-align: top;
            display: inline-block;
            padding-top: 0.5em;
            padding-bottom: 0.25em;
            padding-left: 0.25em;
            padding-right: 0.25em;
            background-color: var(--color-dark);
            background-image: linear-gradient(to right, var(--color-base), var(--color-dark));
            border-radius: 0 0 20px 20px;
            color: white;
            font-weight: bolder;
            font-size: 24px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
        }

        .nav-section:first-child {
            margin-left: 0.5em;
        }

        nav .nav-section.active {
            background-image: linear-gradient(to right, var(--color-light), var(--color-dark));
            padding-top: 1.25em;
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
        }

        nav a {
            text-decoration: none;
        }

        dialog {
            scrollbar-width: none;
        }

        .item-dialog {
            border: none;
            background-color: transparent;
        }

        .item-dialog.badges {
            max-width: 600px;
        }

        .item-dialog::backdrop {
            background-color: black;
            opacity: 0.2;
        }

        .item-dialog-body {
            padding: 20px 0;
            background-size: 200px;
            background-color: var(--color-base);
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
        }

        .item-dialog-content {
            background-image: url('/static/items_background.png');
            background-size: 200px;
            padding: 1em;
            background-color: var(--color-light);
        }

        .item-sprite {
            display: inline-block;
        }

        .item-title {
            font-family: HeyGorgeous;
            font-size: 1.25em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .item-description {
            font-family: HeyGorgeous;
            white-space: pre-line;
        }

        .dialog-close-button {
            position: sticky;
            bottom: 0;
        }

        .badge-points {
            font-family: HeyGorgeous;
            margin-bottom: 1.5em;
        }

        .text-bubble {
            text-align: justify;
            position: relative;
            background-color: white;
            border-radius: 20px;
            box-shadow: inset 0px -5px 5px 0px rgba(0, 0, 0, 0.5);
            padding: 1em;
            margin-top: -10px;
            margin-left: 0.15em;
            margin-right: 0.15em;
            margin-bottom: 20px;
        }

        .text-bubble-close-button {
            cursor: pointer;
            position: absolute;
            bottom: -20px;
            right: -20px;
            background-image: url('/static/small_star.png');
            background-color: transparent;
            border: 0;
            height: 60px;
            width: 60px;
            padding: 0;
        }

        .tab-item {
            display: none;
        }

        .tab-item.active {
            display: unset;
        }

        .badge-tabs {
            position: relative;
            z-index: 10;
            margin-top: -3em;
        }

        .tabs {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
        }

        .tab-button {
            position: relative;
            font-family: HeyGorgeous;
            padding: 0.75em 1em;
            color: white;
            background-color: var(--color-dark);
            border-color: var(--color-base);
            border-style: outset;
        }

        .tab-button:hover::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0.05;
            background-color: black;
        }

        .tab-button.active,
        .tab-button:active {
            color: black;
            background-color: var(--color-base);
            border-color: var(--color-base);
            border-style: inset;
        }

        .tab-button:first-child {
            border-radius: 10px 0 0 10px;
        }

        .tab-button:last-child {
            border-radius: 0 10px 10px 0;
        }
    </style>

    <!-- sm -->
    <style media="(min-width: 576px)">
        main {
            padding: 1em;
        }

        .nav-section:first-child {
            margin-left: 1em;
        }

        .text-bubble {
            margin-left: 1em;
            margin-right: 1em;
        }
    </style>

    <!-- md -->
    <style media="(min-width: 768px)">
    </style>

    <!-- lg -->
    <style media="(min-width: 992px)">
    </style>

    <!-- xl -->
    <style media="(min-width: 1200px)">
    </style>
</head>

<body>
    <nav>
        <div class="nav-content">
            <a class="nav-section badges" href="#badges" title="Badges">
                <item-sprite src="/assets/menu.png" size="100" index="0" scale="0.4" scale-sm="0.5"></item-sprite>
            </a>
            <a class="nav-section recipes" href="#recipes" title="Recipes">
                <item-sprite src="/assets/menu.png" size="100" index="1" scale="0.4" scale-sm="0.5"></item-sprite>
            </a>
            <a class="nav-section starpieces" href="#starpieces" title="Star Pieces">
                <item-sprite src="/assets/menu.png" size="100" index="2" scale="0.4" scale-sm="0.5"></item-sprite>
            </a>
            <a class="nav-section shinesprites" href="#shinesprites" title="Shine Sprites">
                <item-sprite src="/assets/menu.png" size="100" index="3" scale="0.4" scale-sm="0.5"></item-sprite>
            </a>
            <a class="nav-section tattlelog" href="#tattlelog" title="Tattle Log">
                <item-sprite src="/assets/menu.png" size="100" index="4" scale="0.4" scale-sm="0.5"></item-sprite>
            </a>
        </div>
    </nav>
    <main>
        <div class="list-container badges">
            <template id="badge-item-tpl">
                <li>
                    <a href="" title="">
                        <item-sprite src="/assets/badges.png" size="100" index="" scale="0.5"
                            scale-md="0.6"></item-sprite>
                    </a>
                </li>
            </template>
            <ul class="list"></ul>

            <dialog class="item-dialog badges">
                <div class="item-dialog-body">
                    <div class="item-dialog-content">
                        <item-sprite class="item-sprite" src="/assets/badges.png" size="100" index=""></item-sprite>
                        <div class="item-title"></div>
                        <div class="badge-points"></div>
                    </div>
                </div>
                <div class="tabs badge-tabs">
                    <button class="tab-button active effect-button" target="badge-effect" type="button" title="Effect">
                        Effect
                    </button>
                    <button class="tab-button locations-button" target="badge-locations" type="button"
                        title="Locations">
                        Locations
                    </button>
                </div>
                <div class="text-bubble">
                    <div class="tab-item active item-description badge-effect"></div>
                    <div class="tab-item item-description badge-locations"></div>
                    <button type="button" autofocus class="dialog-close-button text-bubble-close-button"></button>
                </div>
            </dialog>
        </div>
        <div class="list-container recipes">
            <template id="recipe-item-tpl">
                <li>
                    <a href="" title="">
                        <item-sprite src="/assets/items.png" size="100" index="" scale="0.5"
                            scale-md="0.6"></item-sprite>
                    </a>
                </li>
            </template>
            <ul class="list"></ul>
        </div>
        <div class="list-container starpieces">
            <ul class="list">
                <li>Comming Soon</li>
            </ul>
        </div>
        <div class="list-container shinesprites">
            <ul class="list">
                <li>Comming Soon</li>
            </ul>
        </div>
        <div class="list-container tattlelog">
            <ul class="list">
                <li>Comming Soon</li>
            </ul>
        </div>
    </main>

    <script src="/js/sprite.js"></script>
    <script>
        (() => {
            const SECTIONS = {
                BADGES: "badges",
                RECIPES: "recipes",
                STARPIECES: "starpieces",
                SHINESPRITES: "shinesprites",
                TATTLELOG: "tattlelog",
            };

            function getSectionFromHash() {
                const sectionId = (window.location.hash ?? '').replace('#', '').split(':')[0];
                return Object.values(SECTIONS).includes(sectionId) ? sectionId : SECTIONS.BADGES;
            }

            function getItemIdFromHash() {
                const id = parseInt((window.location.hash ?? '').split(':')[1] ?? 0)
                return isNaN(id) ? 0 : id;
            }

            function updateContent() {
                const sectionId = getSectionFromHash();
                const itemId = getItemIdFromHash();
                updateNav(sectionId);
                updateLists(sectionId);
                updateDialogs(sectionId, itemId);
            };

            function updateNav(sectionId) {
                const sections = document.querySelectorAll('.nav-section');
                for (const sectionEl of sections) {
                    if (sectionEl.classList.contains(sectionId)) {
                        sectionEl.classList.add('active');
                    }
                    else {
                        sectionEl.classList.remove('active');
                    }
                }
            };

            function updateLists(sectionId) {
                const listContainers = document.querySelectorAll('.list-container');
                for (const listContainerEl of listContainers) {
                    if (listContainerEl.classList.contains(sectionId)) {
                        listContainerEl.classList.remove('hidden');
                    }
                    else {
                        listContainerEl.classList.add('hidden');
                    }
                }
            };

            let badgesPromise = null;
            async function loadBadgesData() {
                if (badgesPromise === null) {
                    const datasrc = document.getElementById('badgedata').href;
                    badgesPromise = fetch(datasrc).then((r) => r.json());
                }
                return badgesPromise;
            }

            async function loadBadgeList() {
                const data = await loadBadgesData();

                const list = document.querySelector('.list-container.badges .list');
                while (list.firstChild) {
                    list.firstChild.remove();
                }

                const badgeItemTpl = document.getElementById('badge-item-tpl');
                let i = 0;
                for (const badge of data) {
                    const el = badgeItemTpl.content.cloneNode(true);
                    el.querySelector('item-sprite').setAttribute('index', i);
                    const link = el.querySelector('a');
                    link.setAttribute('href', `#badges:${badge.id}`);
                    link.setAttribute('title', badge.name);
                    list.appendChild(el);
                    i++;
                }
            }

            let itemsPromise = null;
            async function loadItemsData() {
                if (itemsPromise === null) {
                    const datasrc = document.getElementById('itemdata').href;
                    itemsPromise = fetch(datasrc).then((r) => r.json());
                }
                return itemsPromise;
            }

            async function loadRecipeList() {
                const data = await loadItemsData();

                const list = document.querySelector('.list-container.recipes .list');
                while (list.firstChild) {
                    list.firstChild.remove();
                }

                const recipeItemTpl = document.getElementById('recipe-item-tpl');
                let i = 0;
                for (const recipe of data) {
                    if (recipe.id > 0) {
                        const el = recipeItemTpl.content.cloneNode(true);
                        el.querySelector('item-sprite').setAttribute('index', i);
                        const link = el.querySelector('a');
                        link.setAttribute('href', `#recipes:${recipe.id ?? 0}`);
                        link.setAttribute('title', recipe.name);
                        list.appendChild(el);
                    }
                    i++;
                }
            }

            function updateDialogs(sectionId, itemId) {
                if (itemId === 0) {
                    const dialogs = document.querySelectorAll('.item-dialog');
                    for (const dialog of dialogs) {
                        dialog.close();
                    }
                    return;
                }

                switch (sectionId) {
                    case SECTIONS.BADGES:
                        openBadgeDialog(itemId);
                        break;
                    case SECTIONS.RECIPES:
                        openRecipeDialog(itemId);
                        break;
                }
            }

            async function openBadgeDialog(itemId) {
                const badges = await loadBadgesData();
                const index = badges.findIndex(({id}) => id === itemId);
                const badgeDialog = document.querySelector('.item-dialog.badges');
                if (index === -1) {
                    badgeDialog.close();
                    return;
                }
                const badge = badges[index];

                badgeDialog.querySelector('item-sprite').setAttribute('index', index);

                badgeDialog.querySelector('.item-title').textContent = badge.name;

                badgeDialog.querySelector('.badge-points').textContent = `${badge.bp} BP`;
                badgeDialog.querySelector('.item-description.badge-effect').textContent = badge.effect.replaceAll(/\. ([A-Z])/g, '.\n\n$1').trim('\n');
                badgeDialog.querySelector('.item-description.badge-locations').textContent = badge.locations.replaceAll('\n', '\n\n').trim('\n');


                badgeDialog.showModal();
            }

            function openRecipeDialog(itemId) { }

            // Initialization
            loadBadgeList();
            loadRecipeList();
            updateContent();

            window.addEventListener('hashchange', updateContent);

            for (const dialog of document.querySelectorAll('dialog.item-dialog')) {
                dialog.addEventListener('click', function (event) {
                    const {top, left, width, height} = dialog.getBoundingClientRect();
                    const [x, y] = [event.clientX, event.clientY];
                    if (top > y || y > (top + height) || left > x || x > (left + width)) {
                        dialog.close();
                    }
                });
                dialog.querySelector('.dialog-close-button').addEventListener('click', () => dialog.close());
                dialog.addEventListener('close', () => window.location.hash = `#${getSectionFromHash()}`);

                for (const btn of dialog.querySelectorAll('.tab-button')) {
                    btn.addEventListener('click', function (event) {
                        event.preventDefault();
                        for (const btn of dialog.querySelectorAll('.tab-button')) {
                            if (btn === event.target) {
                                btn.classList.add('active');
                            }
                            else {
                                btn.classList.remove('active');
                            }
                        }

                        const targetClass = event.target.getAttribute('target');
                        for (const el of dialog.querySelectorAll('.tab-item')) {
                            if (el.classList.contains(targetClass)) {
                                el.classList.add('active');
                            }
                            else {
                                el.classList.remove('active');
                            }
                        }
                    });
                }
            }
        })();
    </script>
</body>

</html>
